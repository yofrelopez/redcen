// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  INSTITUTION  // Institución que publica notas
  JOURNALIST   // Periodista acreditado
  ADMIN        // Administrador de la plataforma
}

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  name         String?
  abbreviation String   @unique // Short name for the institution
  passwordHash String
  role         Role     @default(INSTITUTION)
  isActive     Boolean  @default(true) // Account status for soft delete
  
  description  String?  // About the institution
  website      String?  // Institution website
  logo         String?  // Logo URL (Cloudinary)
  
  notes        PressNote[]

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Institution Profile Fields
  slug         String   @unique // URL amigable (ej: /institucion/municipalidad-lima)
  banner       String?   // Imagen de portada
  
  // Ubicación
  region       String?
  province     String?
  district     String?
  address      String?
  googleMapsUrl String?

  // Contacto
  phone        String?
  publicEmail  String?
  socialLinks  Json?     // { facebook: string, twitter: string, etc. }
}

model PressNote {
  id          String   @id @default(cuid())
  title       String
  slug        String   @unique
  mainImage        String?
  mainImageAlt     String?
  mainImageCaption String?
  gallery          String[]
  ogImage          String?  // URL de la imagen Open Graph pre-generada en Cloudinary
  content     String   @db.Text
  summary     String?
  published   Boolean  @default(false)
  

  // Ubicación
  region      String?
  province    String?
  district    String?

  // SEO
  metaTitle       String?
  metaDescription String?
  tags            String[] @default([])

  // Métricas
  views       Int      @default(0)

  // Programación
  scheduledFor DateTime?
  
  categoryIds String[] @default([]) // IDs de categorías asignadas
  
  authorId    String
  author      User     @relation(fields: [authorId], references: [id])

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  type        NoteType @default(PRESS_NOTE)
}

enum NoteType {
  PRESS_NOTE
  STATEMENT
  EVENT
  PODCAST
  VIDEO
  OPINION
  DOCUMENT
  ALERT
  GALLERY
  REPORT
}

model Category {
  id        String   @id @default(cuid())
  name      String   @unique
  slug      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
